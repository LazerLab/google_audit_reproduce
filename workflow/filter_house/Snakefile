import os

DATA_ROOT = "/net/lazer/lab-lazer/shared_projects/google_audit_reproduce/intermedidate_files"
PATH_TO_QRY_INFO = "../../data/qry_info.csv"

RAW_PARQUET_PATH = os.path.join(DATA_ROOT, "parquet_with_domain")
RAW_PARQUET_FILE = os.path.join(RAW_PARQUET_PATH, "{date}.parquet")


OUTPUT_ROOT_HOUSE = os.path.join(DATA_ROOT, "parquet_house")
UPDATE_PARQUET_FILE_HOUSE = os.path.join(OUTPUT_ROOT_HOUSE, "{date}.parquet")


# Infer dates
dir_list = os.listdir(RAW_PARQUET_PATH)

DATES = []
for r in dir_list:
    if r=='.ipynb_checkpoints':
        continue
    r = r.replace('.parquet', '')
    DATES.append(r)

#DATES = ['20201006']
    
rule all:
    input:
        expand(RAW_PARQUET_FILE, date=DATES),
        expand(UPDATE_PARQUET_FILE_HOUSE, date=DATES)
        
        
rule split_office:
    input:
        RAW_PARQUET_FILE
    output:
        qry_info = PATH_TO_QRY_INFO,
        csv = UPDATE_PARQUET_FILE_HOUSE
    shell:
        """
        python3 seperate_office.py {input} {output.qry_info} {output.csv}
        """